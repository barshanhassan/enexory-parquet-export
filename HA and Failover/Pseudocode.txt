WRITE_HG = 10
READ_HG = 20
BROKEN_HG = 30
SLEEP_INTERVAL = 1
CURRENT_MASTER, ALL_NODES{node: status}

LOOP START
	TRY_DAILY_EMAIL_REPORT(Fresh check, no ALL_NODES variable)

	TEMP_CURRENT_MASTER, TEMP_ALL_NODES = get_proxysql_state_from_host_groups([WRITE_HG, READ_HG, BROKEN_HG])

------------------------------------------

	SEGMENT: Find removed nodes (missing or hg40) from ProxySQL -> Update Current Master & All Nodes | Skip iteration of ProxySQL problem.
	SEGMENT: Ping nodes to see if alive and check replication status. -> Update ProxySQL STATUS & Create a temp all nodes status | Skip iteration of ProxySQL problem. 
	SEGMENT: EMAIL_ANOMALIES_WITH_QUORUM_STATUS
	SEGMENT: Check Quorum, Skip iteration if problem.
	SEGMENT: Check again if Master Dead or Missing -> Promote Suitable Replica and Point Remaining Replicas. Update ProxySQL first btw, if not possible then skip iteration.
	SEGMENT: Find added or now alive nodes and point to current master. Check res and record in ALL_NODES status
	SEGMENT: EMAIL_TOPOLOGY if any changes in topology

------------------------------------------

	EMAIL(GENERATE_TEMPLATE(TEMP_CURRENT_MASTER, CURRENT_MASTER, TEMP_ALL_NODES, ALL_NODES))
	ALL_NODES = TEMP_ALL_NODES

	SLEEP(SLEEP_INTERVAL)
LOOP END